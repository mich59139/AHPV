<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AHPV ‚Äì Catalogue des Articles</title>
  <link rel="icon" href="assets/favicon.png" type="image/png" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="shell">
    <header class="brand">
      <a id="brand-link" href="https://www.amisdelhistoiredupaysvizillois.fr/" target="_blank" rel="noopener">
        <img src="assets/logo-ahpv.png" alt="AHPV" class="brand-logo" />
      </a>
      <div class="brand-text">
        <div class="brand-line">Amis de l‚ÄôHistoire du Pays Vizillois</div>
        <h1>Catalogue des Articles</h1>
      </div>
    </header>

    <section class="panel badges">
      <span id="status-count">Fichier : ‚Äî</span>
      <span id="status-auth">üîì Invit√©</span>
      <span class="grow"></span>
      <button id="login-btn" class="btn">üîê Connexion</button>
      <button id="logout-btn" class="btn">üö™ D√©connexion</button>
      <button id="help-btn" class="btn">‚ùì Aide</button>
    </section>

    <section class="panel filters">
      <label>Ann√©e
        <select id="filter-annee" aria-label="Filtrer par ann√©e">
          <option value="">(toutes)</option>
        </select>
      </label>
      <label>Num√©ro
        <select id="filter-numero" aria-label="Filtrer par num√©ro">
          <option value="">(tous)</option>
        </select>
      </label>
      <label>√âpoque
        <select id="filter-epoque" aria-label="Filtrer par √©poque">
          <option value="">(toutes)</option>
        </select>
      </label>
      <label class="grow">Recherche
        <input id="search" type="text" placeholder="titre, auteur, ville, th√®me‚Ä¶" aria-label="Recherche" />
      </label>
      <button class="btn" onclick="resetAllFilters()">‚Ü∫ R√©initialiser</button>
    </section>

    <section class="panel controls">
      <button class="btn primary" onclick="window._openAddModal?.()">‚ûï Ajouter un article</button>
      <button class="btn" id="lists-btn">üßæ Listes</button>
    </section>

    <section class="panel exports">
      <button class="btn" id="export-copy">üìã Copier</button>
      <button class="btn" id="export-csv">‚¨áÔ∏è CSV</button>
      <button class="btn" id="export-xlsx">‚¨áÔ∏è Excel</button>
      <button class="btn" id="export-print">üñ®Ô∏è Imprimer</button>
      <span class="sep"></span>
      <button class="btn" id="export-csv-all">‚¨áÔ∏è CSV (Tout)</button>
      <button class="btn" id="export-xlsx-all">‚¨áÔ∏è Excel (Tout)</button>
    </section>

    <div class="table-wrap">
      <table class="responsive" aria-describedby="pageinfo">
        <thead>
          <tr>
            <th role="button" tabindex="0" data-col="Ann√©e">Ann√©e</th>
            <th role="button" tabindex="0" data-col="Num√©ro">Num√©ro</th>
            <th role="button" tabindex="0" data-col="Titre">Titre</th>
            <th role="button" tabindex="0" data-col="Page(s)">Page(s)</th>
            <th role="button" tabindex="0" data-col="Auteur(s)">Auteur(s)</th>
            <th role="button" tabindex="0" data-col="Ville(s)">Ville(s)</th>
            <th role="button" tabindex="0" data-col="Theme(s)">Th√®me(s)</th>
            <th role="button" tabindex="0" data-col="Epoque">P√©riode</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <section class="panel pager">
      <button class="btn" id="prev">‚óÄ</button>
      <span id="pageinfo" aria-live="polite">‚Äî</span>
      <button class="btn" id="next">‚ñ∂</button>
    </section>

    <div id="loading" class="loading hidden" role="status" aria-live="assertive">Chargement‚Ä¶</div>

    <!-- Modal : Ajout -->
    <dialog id="add-modal" class="modal">
      <form method="dialog" id="add-form">
        <h3>Ajouter un article</h3>
        <div class="grid">
          <label>Ann√©e
            <input id="a-annee" required />
          </label>

          <label>Num√©ro
            <select id="a-numero" required>
              <option value="">(choisir)</option>
            </select>
            <input id="a-numero-new" class="hidden" value="" placeholder="M√©moire n¬∞‚Ä¶" />
          </label>

          <label>Titre
            <input id="a-titre" required />
          </label>

          <label>Page(s)
            <input id="a-pages" />
          </label>

          <label>Auteur(s)
            <input id="a-auteurs" list="dl-auteurs" />
          </label>

          <label>Ville(s)
            <input id="a-villes" list="dl-villes" />
          </label>

          <label>Th√®me(s)
            <input id="a-themes" list="dl-themes" />
          </label>

          <label>√âpoque
            <input id="a-epoque" list="dl-epoques" />
          </label>
        </div>
        <menu>
          <button type="button" class="btn" id="add-cancel">Annuler</button>
          <button type="submit" class="btn primary" id="add-submit">Ajouter</button>
        </menu>
      </form>
    </dialog>

    <!-- Modal : Aide -->
    <dialog id="help-modal" class="modal">
      <div class="help-panel">
        <h3>Aide</h3>
        <div class="help-body">
          <h4>Listes s√©par√©es</h4>
          <ul>
            <li>Suggestions depuis <code>data/auteurs.csv</code>, <code>data/villes.csv</code>, <code>data/themes.csv</code>, <code>data/epoques.csv</code>.</li>
          </ul>
          <h4>Exports</h4>
          <ul>
            <li>Filtr√© : Copier, CSV, Excel, Imprimer ‚Äî Tout : CSV/Excel (ignore les filtres).</li>
          </ul>
        </div>
        <menu><button id="help-close" class="btn">Fermer</button></menu>
      </div>
    </dialog>

    <!-- Modal : Listes -->
    <dialog id="lists-modal" class="modal">
      <div class="lists">
        <h3>Listes de r√©f√©rence</h3>
        <nav class="tabs">
          <button data-kind="auteurs" class="tab active">Auteurs</button>
          <button data-kind="villes"  class="tab">Villes</button>
          <button data-kind="themes"  class="tab">Th√®mes</button>
          <button data-kind="epoques" class="tab">√âpoques</button>
          <span id="list-count" class="count"></span>
        </nav>

        <div class="editor">
          <div class="toolbar">
            <input id="list-input" type="text" placeholder="Ajouter un √©l√©ment‚Ä¶" />
            <button id="list-add" class="btn">Ajouter</button>
            <button id="list-sort" class="btn">Trier A ‚Üí Z</button>
            <button id="list-dedupe" class="btn">D√©dupliquer</button>
            <button id="list-import" class="btn">Importer CSV</button>
            <input id="list-file" type="file" accept=".csv,.txt" hidden />
            <button id="list-export" class="btn">Exporter CSV</button>
          </div>
          <ul id="list-items" class="items" aria-live="polite"></ul>
        </div>

        <menu>
          <button id="list-save" class="btn primary">üíæ Enregistrer</button>
          <button id="list-close" class="btn">Fermer</button>
        </menu>
      </div>
    </dialog>

    <datalist id="dl-auteurs"></datalist>
    <datalist id="dl-villes"></datalist>
    <datalist id="dl-themes"></datalist>
    <datalist id="dl-epoques"></datalist>
  </div>

  <!-- Anti-cache basique c√¥t√© script -->
  <script>
    const v = Date.now();
    const s = document.createElement('script');
    s.src = 'app.js?_=' + v;
    s.defer = true;
    document.body.appendChild(s);
  </script>
</body>
</html>
